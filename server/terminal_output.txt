✅ Google Gemini 2.0 Flash initialized successfully
📊 Loaded 3 detailed Postman APIs for darwinbox
Server running on port 5000
📚 Loaded examples for: apis_used, assumptions, dependencies, error_handling, integration_description_and_overview, purpose_justification, technical_content_or_specification
🎨 Graphviz initialized successfully
🔍 [REQ-1748270375870-3btnhh] Starting /api/generate-brd request
Transformed outputs: [
  { name: 'Purpose/Justification', types: [ 'content' ] },
  {
    name: 'Integration Description and Overview',
    types: [ 'content' ]
  },
  { name: 'Technical Design Specifications', types: [ 'content' ] },
  { name: 'Assumptions', types: [ 'content' ] },
  { name: 'Dependencies', types: [ 'content' ] },
  { name: 'APIs Used', types: [ 'table', 'content' ] },
  { name: 'Test Cases', types: [ 'content' ] },
  { name: 'Data Flow Diagram', types: [ 'image', 'content' ] }
]
=== Structured BRD Data ===
📊 Request Summary: {
  template: 'Attendance Inbound Integration',
  client: 'Shopper Stop',
  outputsCount: 8,
  hasBusinessLogic: true,
  sessionId: '14cad1d3-e72f-424a-b4ac-e674b7c43fb5'
}
🔍 [REQ-1748270375870-3btnhh] Calling generateBRD with sessionId: 14cad1d3-e72f-424a-b4ac-e674b7c43fb5
🤖 Generating BRD with AI...
Input data structure: {
  hasTemplate: true,
  hasFormData: true,
  hasBusinessUseCase: true,
  hasBusinessLogic: true,
  hasOutputs: true,
  hasTechnicalData: true,
  hasFiles: false
}
🚀 Starting AI BRD Generation...
📊 Input Summary: {
  template: 'Attendance Inbound Integration',
  client: 'Shopper Stop',
  outputsCount: 8,
  hasBusinessLogic: true,
  sessionId: '14cad1d3-e72f-424a-b4ac-e674b7c43fb5'
}
📋 Context built: {
  mode: 'API-Based',
  direction: 'INBOUND',
  integrationPattern: 'API-Based_INBOUND',
  hasApiDocs: false
}
🔄 Generating: Purpose/Justification
🔄 API call attempt 1/5
🤖 Generating text content for: Purpose/Justification
✅ API call successful on attempt 1
✅ Text content generated for Purpose/Justification (553 chars)
🔄 Generating: Integration Description and Overview
⏳ Waiting 1999ms for rate limit...
🔄 API call attempt 1/5
🤖 Generating text content for: Integration Description and Overview
✅ API call successful on attempt 1
✅ Text content generated for Integration Description and Overview (776 chars)
🔄 Generating: Technical Design Specifications
⏳ Waiting 2000ms for rate limit...
🔄 API call attempt 1/5
🤖 Generating text content for: Technical Design Specifications
✅ API call successful on attempt 1
✅ Text content generated for Technical Design Specifications (2900 chars)
🔄 Generating: Assumptions
⏳ Waiting 2000ms for rate limit...
🔄 API call attempt 1/5
🤖 Generating text content for: Assumptions
✅ API call successful on attempt 1
✅ Text content generated for Assumptions (1086 chars)
🔄 Generating: Dependencies
⏳ Waiting 1999ms for rate limit...
🔄 API call attempt 1/5
🤖 Generating text content for: Dependencies
✅ API call successful on attempt 1
✅ Text content generated for Dependencies (812 chars)
🔄 Generating: APIs Used
🔄 Generating: Test Cases
⏳ Waiting 1999ms for rate limit...
🔄 API call attempt 1/5
🤖 Generating text content for: Test Cases
✅ API call successful on attempt 1
✅ Text content generated for Test Cases (5101 chars)
🔄 Generating: Data Flow Diagram
⏳ Waiting 1999ms for rate limit...
🔄 API call attempt 1/5
🎨 Generating diagram for: Data Flow Diagram
✅ API call successful on attempt 1
✅ Diagram generated for Data Flow Diagram
✅ BRD Generation Complete
✅ AI BRD Generation Successful
📄 Publishing to Confluence using global config...
📄 Creating Confluence BRD page with bulletproof architecture... (attempt 1/5)
🔍 Generated Page ID: BRD-ShopperStop-cabc1b50 (Session: kpd9k)
🏷️ Page Identifier: BRD-ShopperStop-cabc1b50
🔒 Acquiring distributed lock for: BRD-ShopperStop-cabc1b50
🔒 Attempting to acquire lock for: BRD-ShopperStop-cabc1b50
🔗 Confluence API Request: POST /content
🎨 Graphviz initialized successfully
✅ Confluence API Response: 200 OK
✅ Lock acquired for: BRD-ShopperStop-cabc1b50
✅ Lock acquired: 1748270414004-0.8218128879901381
🔍 Performing comprehensive duplicate check...
🔍 Performing comprehensive duplicate check...
📋 Generated Page Title: TS-250526-qnklj8-cp89 Shopper Stop ::  - Integration BRD...
🔗 Confluence API Request: GET /content/search
✅ Confluence API Response: 200 OK
🔍 Level 3 - Recent pages check...
🔗 Confluence API Request: GET /content/search
✅ Confluence API Response: 200 OK
✅ No duplicates found - safe to create new page
📋 Generated Page Title: TS-250526-gndctx-8la2 Shopper Stop ::  - Integration BRD...
📋 Unique Page Title: TS-250526-gndctx-8la2 Shopper Stop ::  - Integration BRD
🔍 Final safety check - exact title search...
🔗 Confluence API Request: GET /content/search
✅ Confluence API Response: 200 OK
📄 Creating new page (no duplicates found)
📄 Creating new Confluence page safely...
🔍 Debug generateSmartContentSections - Available sections: [
  'Purpose/Justification',
  'Integration Description and Overview',
  'Technical Design Specifications',
  'Assumptions',
  'Dependencies',
  'APIs Used',
  'Test Cases',
  'Data Flow Diagram'
]
📝 Processing section: Purpose/Justification (type: object)
📝 Processing section: Purpose/Justification (type: object)
🎯 Detected content type for Purpose/Justification: text
🤖 Processing: Purpose/Justification (type: text)
📝 Processing section: Integration Description and Overview (type: object)
📝 Processing section: Integration Description and Overview (type: object)
🎯 Detected content type for Integration Description and Overview: text
🤖 Processing: Integration Description and Overview (type: text)
📝 Processing section: Technical Design Specifications (type: object)
📝 Processing section: Technical Design Specifications (type: object)
🎯 Detected content type for Technical Design Specifications: text
🤖 Processing: Technical Design Specifications (type: text)
📝 Processing section: Assumptions (type: object)
📝 Processing section: Assumptions (type: object)
🎯 Detected content type for Assumptions: text
🤖 Processing: Assumptions (type: text)
📝 Processing section: Dependencies (type: object)
📝 Processing section: Dependencies (type: object)
🎯 Detected content type for Dependencies: text
🤖 Processing: Dependencies (type: text)
📝 Processing section: APIs Used (type: object)
📝 Processing section: APIs Used (type: object)
🎯 Detected content type for APIs Used: text
🤖 Processing: APIs Used (type: text)
📝 Processing section: Test Cases (type: object)
📝 Processing section: Test Cases (type: object)
🎯 Detected content type for Test Cases: text
🤖 Processing: Test Cases (type: text)
📝 Processing section: Data Flow Diagram (type: object)
📝 Processing section: Data Flow Diagram (type: object)
🎯 Detected content type for Data Flow Diagram: graphviz
🤖 Processing: Data Flow Diagram (type: graphviz)
✅ Generated 8 content sections (12289 chars total)
🚀 Publishing new page to Confluence...
Payload structure: {
  type: 'page',
  title: 'TS-250526-gndctx-8la2 Shopper Stop ::  - Integration BRD',
  spaceKey: 'BRD',
  hasParent: false,
  contentLength: 14129
}
🔗 Confluence API Request: POST /content
✅ Confluence API Response: 200 OK
✅ New Confluence page created successfully
🔗 Page URL: https://raghuvardhan07.atlassian.net/wiki/pages/viewpage.action?pageId=24936514
🔓 Releasing lock: BRD-ShopperStop-cabc1b50
🔗 Confluence API Request: DELETE /content/24936490
✅ Confluence API Response: 204 No Content
🔓 Lock released for: BRD-ShopperStop-cabc1b50

